# О проекте.
Данный бот является усовершенствованной версией бота https://github.com/batazdes/notebook_parsing_bot, который выводил пользователю ноутбуки с заранее забитых в него страниц. Данный бот сам формирует ссылку, в зависимости от выбранных пользователем характеристик ноутбуков.

Как и предыдущий он выводит ссылку на страницу модели, ее фотогрфию, название и цену. 

Для работы программ необходимо установить библиотеки **aiogram**,**lxml**,**requests**.

```
pip install requests
pip install aiogram
pip install bs4
pip install termcolor
```

# Принцип работы.
Проект состоит из 4 основных программ *telegram_bot.py* (отвечает за функционал бота), *making_url.py* (формирует URL на основе выбранных характеристик), *notebook_parser_without_pages.py* (отвечает за парсинг конкретной страницы), *notebook_parser.py* (вызывает *notebook_parser_without_pages.py* в зависимости от количества полученных страниц).

После нажатия **start** бот предлагает выбрать категорию товаров (пока что это только ноутбуки), потом пользователь может выбрать диапазон цен (если он пропускает этот выбор, то диапазон формируется автоматически от минимального до максимально возможного значений), производителя, процессор, разрешение экрана и тип матрицы, объем SSD накопителя и оперативной памяти. Также пользователь может не выбирать ни один из этих параметров - это будет учтено при формировании ссылки, или выбрать один и тот же вариант несколько раз раз - это учтено не будет). 

![image](https://user-images.githubusercontent.com/91262020/145013374-7f3aadb7-cebd-4bc4-b54f-29807fb7c6bf.png)
![image](https://user-images.githubusercontent.com/91262020/145013433-17b40dbd-8d50-45d6-bf74-ab5f49df415c.png)

Когда пользователь закончит выбор характеристик и подтвердит их, сформированный *user_data.json* будет обрабатываться функцией из программы *making_url.py*, ссылка будет записана в файл *url.txt*, после чего прочитана функцией из программы *notebook_parser.py*. Та проанализирует html страницы, и если увидит ссылки на следующие страницы, то в зависимости от их количества вызовет программу *notebook_parser_without_pages.py* опредленное число раз. Результаты будут записаны в result_data_citilink.json, из которого затем прочтены телеграмм ботом и выведены пользователю. Картинки качаются отдельно *notebook_parser_without_pages.py* в директорию **Notebooks_photo** под именами соответствующих моделей, из которой же потом и выводятся по ним.
После всего этого пользователь возвращается к выбору категории товара.

![image](https://user-images.githubusercontent.com/91262020/145013579-e765bebd-3015-4700-ac94-bdebadb5e9e4.png)

Если программе не удастся получить доступ к странице по выбранным характеристикам, то значит ноутбуков нет в наличии, и будет выведено соотвествующее сообщение.

Файл *token.txt* содержит токен бота.
Файл *data.txt* хранит промежуточные данные при выборе характеристик, которые после нажатия **продолжить** сохраняются, а файл очищается.

# Недостатки бота
Из-за массивновсти тела бота, в него может быть проблематично добавлять новые категории.
